{% extends 'fls/base_template.html' %}
{% block title %}Заявка{% endblock %}
{% block content %}
    <h3>Заявка</h3>
    <hr>
    <div class="card" style="width: 70rem;">
        <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><p>Конкурс - {{ request.competition.name }}</p></li>
                <li class="list-group-item"><p>Группа - {{ request.participant.group.name }}</p></li>
                <li class="list-group-item"><p>Загрузил пользователь {{ request.participant.get_username }}</p></li>
                <li class="list-group-item"><p>Содержание заявки</p>
                    <div class="container">
                        {% for v in  values %}
                            {% with param=v.0 sbvalues=v.1 %}
                                <p>Параметр '{{ param.name }}' </p>
                                {% for sb in sbvalues %}
                                    <p> Подпараметр {{ sb.get_name }}</p>
                                    {% if sb.is_number %}
                                        {{ sb.value }}
                                    {% endif %}
                                    {% if sb.is_photo %}
                                        {% for f in sb.get_files %}
                                            <img src="{{ f.image.url }}" alt="{{ f.header_for_file }}">
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                            {% endwith %}
                        {% endfor %}
                    </div>
                </li>
            </ul>
        </div>
    </div>
    {% if request.participant == user %}
        <button type="button" class="btn">Редактировать заявку</button>
        {#        <form method="post" action="{% url 'fls:delete_req' request.id %}" hidden>#}
        {#            {% csrf_token %}#}
        {#            <button type="submit" class="btn btn-danger">Удалить заявку</button>#}
        {#        </form>#}
    {% endif %}
    {% if user.is_jury and not estimate_flag %}
        <h4>Вы еще не оценили заявку </h4>
        <br>
        <button id="estimate" type="button" class="btn">Оценить заявку</button>
    {% endif %}
    {% if estimate_flag %}
        <br>
        <h4>Вы оценили эту заявку как <b>{{ estimate_val }}</b> из <b>{{ request.competition.max_limit }}</b></h4>
        <br>
        <button id="edit" type="button" class="btn">Редактировать оценку</button>
        <br>
        <br>
        <form method="post" action="{% url 'fls:estimate_del' estimate_id %}">
            {% csrf_token %}
            <button id="delete" type="submit" class="btn btn-danger">Удалить оценку</button>
        </form>
    {% endif %}

    <form id="form" method="post" action="{% url 'fls:estimate_req' request.id %}" hidden>
        <br>
        {% csrf_token %}
        <label>Оценка заявки
            <input type="text" name="est_val" value="{% if estimate_val %}
                {{ estimate_val }}
                {% endif %}">
        </label>
        <button type="submit" class="btn btn-primary labelText">
            <span>Сохранить</span>
        </button>
    </form>
{% endblock %}
{% block script %}
    <script>
        $("#estimate").click(function () {
            $("#form").show();
            $('#estimate').hide();
        });
        $("#edit").click(function () {
            $("#form").show();
            $('#edit').hide();
            $("#delete").hide();
        });
    </script>
{% endblock %}