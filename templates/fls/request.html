{% extends 'fls/base_template.html' %}
{% block title %}Заявка на конкурс {{ request.competition.name }}{% endblock %}
{% block content %}
    <h3>Заявка</h3>
    <hr>

    <h4>Конкурс - {{ request.competition.name }}</h4>
    <h4>Загрузил пользователь {{ request.participant.get_username }}</h4>
    <h4>Содержание заявки</h4>
    <div class="container">
        <form id="form" method="post" action="{% url 'fls:estimate_req' request.id %}">
            {% csrf_token %}
            {% for v in  values %}
                {% with param=v.0 sbvalues=v.1 est=v.2 %}
                    <h4>Критерий <b>'{{ param.name }}'</b></h4>
                    {% for sb in sbvalues %}
                        <h4> Параметр критерия - {{ sb.get_name }} <strong>{% if sb.is_number %}
                            - {{ sb.value }}
                        {% endif %} {% if sb.is_enum %}  - {{ sb.enum_val.enum_key }}{% endif %}</strong></h4>
                        {% if sb.is_photo %}
                            <div id="myCarousel" class="carousel slide" data-ride="carousel"
                                 style="width: 400px; height:400px;">

                                <div class="carousel-inner">
                                    {% for f in sb.get_files %}
                                        <div class="item {% if forloop.counter0 == 0 %} active {% endif %}">
                                            <img src="{{ f.image.url }}" alt="{{ f.header_for_file }}"
                                                 style="width: 80%; height: 80%">
                                        </div>
                                    {% endfor %}
                                </div>

                                <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                                    <span class="glyphicon glyphicon-chevron-left"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="right carousel-control" href="#myCarousel" data-slide="next">
                                    <span class="glyphicon glyphicon-chevron-right"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                        {% endif %}

                    {% endfor %}
                    <div class="form-group for_form" hidden>
                        <label>Оценка критерия
                                <input type="number" class="form-control" name="est_val_{{ param.id }}"
                                       value="{{ est }}">
                        </label>
                    </div>
                    <hr>
                {% endwith %}
            {% endfor %}
            <div class="for_button" hidden>
                <button type="submit" class="btn btn-primary labelText">
                    <span>Сохранить</span>
                </button>
            </div>
        </form>
    </div>

    <br>


    {% if request.participant == user %}
        <button type="button" class="btn">Редактировать заявку</button>
        <br>
        <br>
        <form method="post" action="{% url 'fls:delete_req' request.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Удалить заявку</button>
        </form>
    {% endif %}
    {% if user.is_jury  and request.competition.status == 3 and flag %}
        {% if estimate_flag %}
            <button id="edit" type="button" class="btn">Редактировать оценку</button>
            <br><br>
            <form method="post" action="{% url 'fls:estimate_del' request.id %}">
                {% csrf_token %}
                <button id="delete" type="submit" class="btn btn-danger">Удалить оценку</button>
            </form>
        {% else %}
            <h4>Вы еще не оценили заявку </h4>
            <br>
            <button id="estimate" type="button" class="btn">Оценить заявку</button>
        {% endif %}
    {% endif %}

{% endblock %}
{% block script %}
    <script>
        $("#estimate").click(function () {
            $(".for_button").show();
            $(".for_form").show();
            $('#estimate').hide();
        });
        $("#edit").click(function () {
            $(".for_button").show();
            $(".for_form").show();
            $("#edit").hide();
            $("#delete").hide();
        });
    </script>
{% endblock %}