{% load static %}
{% load custom_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Метод попарного сравнения</title>
    <link href="{% static "css/bootstrap.min.css" %}" type="text/css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
<div class="container">
    <br>
    <form name="form" id="form" action="{% url 'fls:pairwise_comparison' comp_id %}" method="post">
        {% csrf_token %}
        <table class="table table-bordered" id="itable">
            <caption class="text-center" style="font-family: 'Comic Sans MS',monospace"><strong>Попарные сравнения
                параметров</strong></caption>
            <thead>
            <tr>
                <th scope="col"></th>
                {% for p in params %}
                    <th scope="col">{{ p }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for key, value in params.items %}
                <tr>
                    <th scope="col">{{ key }}</th>
                    {% for item in value %}
                        <th scope="col">
                            {% if item|filter_equals %}
                            {% else %}
                                <select name="{{ item }}" id="{{ item }}" class="cell form-control">
                                    <option selected value="-">-</option>
                                    <option value="0">0</option>
                                    <option value="0.5">0,5</option>
                                    <option value="1">1</option>
                                </select>
                            {% endif %}
                        </th>
                    {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <p class="has-error" style="font-weight:bold; color: #c10d1f; font-family: 'Comic Sans MS',monospace" hidden>
            Заполните все поля!</p>
        <button type="submit" id="submit" class="btn btn-primary labelText">
                                <span style="font-family: 'Comic Sans MS',monospace">
                                Сохранить
                                    </span>
        </button>
    </form>
</div>
</body>
<script>
    $(document).ready(function () {
        $('.container').on('change', '.cell', function () {
            var ids = $(this).attr("id").split("_");
            var new_id = "#" + ids[1] + "_" + ids[0];
            var old_value = $(this).val();
            var color = '#79ff4d';
            $(this).css('background-color', color);
            $(new_id).css('background-color', color);
            $(".has-error").hide();
            if (old_value === "1") {
                $(new_id).val("0");
            } else if (old_value === "0") {
                $(new_id).val("1");
            } else if (old_value === "0.5") {
                $(new_id).val("0.5");
            } else {
                $(new_id).val("-");
                $(this).css('background-color', 'white');
                $(new_id).css('background-color', 'white');
            }
        });

        $('#submit').click(function () {
            $('form[name=form]').submit(function (e) {
                var sub = true;
                $(":selected").each(function () {
                    if ($(this).val() === "-") {
                        sub = false;
                        $(".has-error").show();
                        return sub;
                    }
                });
                return sub;
            });
        });
    });


</script>
</html>