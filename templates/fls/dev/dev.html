<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Похожие оценки</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/css/bootstrap-select.min.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/js/bootstrap-select.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/js/i18n/defaults-*.min.js"></script>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">Аналитика результатов</a>
        </div>
        <ul class="nav navbar-nav">
            <li><a href="{% url 'fls:common' %}">Результаты</a></li>
            <li><a href={% url 'fls:simjury' %}>Схожесть жюри</a></li>
            <li><a href="{% url 'fls:metcomp' %}">Сравнение методов</a></li>
            <li class="active"><a href="{% url 'fls:devpage' %}">Отклонения оценок</a></li>


        </ul>
    </div>
</nav>
<div class="container" style="margin-top: 50px">
    <div class="row">
        <div class="col-sm-4">
            <label for="comp">Выберите конкурс:</label>
            <br>
            <select id="comp" name="comp" class="selectpicker">
                {% for comp in comps %}
                    <option value={{ comp.id }}>{{ comp.name }}</option>
                {% endfor %}
            </select>
            <br>
            <br id="place">
            <label for="type">Выберите метод:</label>
            <br>
            <select name="type" id="type" class="selectpicker">
                <option value="1">Ручная оценка</option>
                <option value="3">Сравнение параметров</option>
            </select>
            <br>
            <br>

            {#            <label for="reqs">Участник:</label>#}
            {#            <br>#}
            {#            <select name="reqs" id="reqs">#}

            {#            </select>#}
            <div id="reqfil"></div>


            <br>
        </div>
        <div class="col-sm-8" id="paste">
            {#            <table id="values" class="table table-striped table-bordered">#}
            {##}
            {#            </table>#}
        </div>
    </div>
</div>


</body>
<script>

    const f = function () {
        comp_id = $('#comp').val();
        type = $('#type').val();
        reqs = $('#req').val();
        $.ajax({
            url: '/fls/deviation/',
            type: 'get',
            data: {'comp': comp_id, 'type': type, 'reqs': reqs},
            dataType: 'json',
            success: function (data) {
                $("#paste").html(data.est)
            },
            error: function () {
                alert("error");
            },
            complete: function (data) {
                color_range();
            }
        })

    };

    const fill = function () {
        comp_id = $('#comp').val();
        $.ajax({
            url: '/fls/comp_reqs/',
            type: 'get',
            data: {'comp': comp_id},
            dataType: 'json',
            success: function (data) {

                {#$('#reqs').html(data.reqs);#}
                $("#reqfil").html(data.reqs);
                {#$(data.reqs).insertAfter("#place");#}
            },
            error: function () {
                alert("error");
            },
            complete: function (data) {

                $('#req').addClass('selectpicker');
                $('#req').selectpicker();
                f();
            }
        })

    };

    const color_range = function () {
        color_pos = ['b3ffcc', '99ffbb', '80ffaa', '66ff99', '#4dff88', '#33ff77', '#1aff66', '#00ff55', '#00e64d'];
        color_neg = ['ffe6ee', 'ffccdd', '#ffb3cc', '#ff99bb', '#ff80aa', '#ff6699', '#ff4d88'];
        $(".paint").each(function (i) {
            {#console.log($(this).text());#}
            diff_value = parseFloat($(this).text());
            console.log(diff_value);
            if (diff_value >= 0) {

                color = color_pos[(color_pos.length - 1) - Math.round(diff_value)];
            }
            else {
                color = color_neg[(color_neg.length - 1) - Math.round(Math.abs(diff_value))];

            }
            {#$(this).css("background-color", color);#}
            $(this).css("background-color", color);
        })

    };

    select_comp = $('#comp');
    select_type = $('#type');


    {#select_reqs = $('#req');#}

    select_comp.selectpicker();
    select_type.selectpicker();
    {#select_reqs.selectpicker();#}
    {#$('#send').click(f);#}
    $(document).ready(fill);
    select_comp.change(fill);
    select_type.change(f);
    {#select_reqs.selectpicker();#}

    {#$('#req').change(alert('hh'));#}
    $('#reqfil').on('change', '#req', function () {
        f();
    });


</script>
</html>